# 第四章：エンジンの構築（投稿パイプライン）

1つの言葉を叫ぶことはできましたが、毎回コードを書き換えて実行するのは「自動化」ではありません。

私が構築したシステムの本質は、「コードを触らずに、テキストファイルを置くだけで勝手に投稿されていく」という**パイプライン処理**にあります。

工場のベルトコンベアをイメージしてください。

「素材（原稿）」を置くと、機械がそれを「加工（投稿）」し、終わったら「倉庫（ログ）」に片付ける。この流れを作ります。

## 1. フォルダ構成を作る

プロジェクトフォルダの中に、以下の2つのフォルダを作ってください。

- `queue` （キュー）：これから投稿する原稿を入れる場所
- `archived` （アーカイブ）：投稿が終わった原稿を移動させる場所

## 2. 原稿を作る

`queue` フォルダの中に、テキストファイルをいくつか作ってみましょう。ファイル名はなんでも良いですが、アルファベット順に処理させると管理が楽です。

- `queue/001.txt` -> 中身：「これはテスト投稿1です」
- `queue/002.txt` -> 中身：「これはテスト投稿2です」

## 3. AIにパイプラインを組ませる

複雑なファイル操作も、手順を箇条書きにすればAIが理解します。
`pipeline_runner.py` という、工場の心臓部を作らせましょう。

### プロンプト例：パイプライン処理の実装

```markdown
Pythonで、指定フォルダ内のテキストファイルを検知してXに投稿する自動化スクリプトを作成してください。

### 仕様
1. ファイル名: pipeline_runner.py
2. フォルダ構成:
   - `queue` : 未処理のテキストファイルが入る場所
   - `archived` : 処理済みのファイルを移動する場所
3. 処理の流れ:
   - `queue` フォルダ内のファイルを確認する（隠しファイルは無視）
   - ファイルがあれば、アルファベット順で先頭の1つだけを読み込む
   - そのファイルの内容（テキスト）をX API (Tweepy)を使って投稿する
   - 投稿に成功したら、そのファイルを `archived` フォルダに移動する
   - ファイルがない場合は、「処理するファイルがありません」と表示して終了する
   
4. エラー処理:
   - エラーが発生した場合は、コンソールにエラー内容を表示し、ファイルの移動は行わない（再試行のため）
```

AIが生成したコードを保存すれば、あなたの工場は完成です。

## 4. 動かしてみる

ターミナルで実行します。

```bash
python pipeline_runner.py
```

すると、`queue` フォルダにあった `001.txt` の中身が投稿され、そのファイルは瞬時に `archived` フォルダへ移動します。
もう一度実行すると、今度は `002.txt` が投稿され、移動します。
もう一度実行すると、「投稿する原稿がありません」と言われます。

これが**パイプライン**です。

あなたはもう、コードを触る必要はありません。暇な時に書き溜めたメモを `queue` フォルダに放り込んでおくだけでいいのです。

あとはこのスクリプトを、朝7時などに自動実行するよう設定（Cronなど）すれば、完全な自動運転が始まります。

しかし、自動運転には「事故」がつきものです。
次章では、荒野を走り続けるための「安全装置」について学びます。
