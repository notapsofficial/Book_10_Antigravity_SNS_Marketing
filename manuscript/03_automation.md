# 第3章：エンジンを回す - 完全自動化へ

APIがつながり、投稿できるようになりました。
しかし、毎日パソコンを開いて `python run.py` と打ち込むのは面倒です。
私たちが目指すのは「不労」です。寝ていても勝手に世界中に投稿がばら撒かれる状態です。

## 日次バッチ処理という「心臓」

私はAIにこう依頼しました。

> **私**: 「この投稿スクリプトを、毎日朝8時に自動で実行したい。どうすればいい？」

AIはいくつかの方法（Cron、クラウドのサーバーレス関数など）を提案してくれましたが、私はGitHub Actionsを使った方法を選びました（後にVercelのCron機能に移行）。
これで、私が寝ていようが遊んでいようが、毎朝8時になるとサーバーが起動し、プログラムが走り出します。

## 失敗談：タイムアウトの悪夢

当初、私は全ての処理を一つのスクリプト（`execute_daily_post.py`）にまとめていました。
1. ネタを考える
2. 画像を作る
3. Xに投稿
4. YouTubeに投稿…

しかし、処理が増えるにつれて、途中で止まることが増えました。
YouTubeの動画処理に時間がかかりすぎて、システム全体の制限時間（タイムアウト）オーバーになってしまったのです。

朝起きると、ダッシュボードが真っ赤（エラー）になっている絶望感。
私はAIに泣きつきました。

> **私**: 「最近よく止まるんだけど、どうにかして！」

Antigravityの診断は的確でした。

> **AI**: 「処理が重すぎますね。スクリプトを『重い処理（準備）』と『軽い処理（投稿）』に分けましょう。
> **Part 1**: 画像生成やデータ取得など、時間がかかる処理を先にやってDBに保存。
> **Part 2**: 投稿するだけの軽い処理を、時間を空けて実行。
> こうすれば安定します。」

これが、現在稼働している `execute_daily_post_part1.py` と `part2.py` の誕生秘話です。
この分割を行ってから、エラー率は劇的に下がりました。素人の私には「プログラムを分ける」なんて発想はありませんでした。

## コンテンツも「生成」する

投稿する画像や文章がない？ それもAIに作らせましょう。
私のシステムでは、デザインすら自動化しています。

### 画像生成：AIへのデザイン発注書

InstagramやPinterestには「映える」画像が必要です。
私はPythonの画像処理ライブラリ「Pillow」を使って、名言画像を作ることにしました。
ここでのAIへの指示（プロンプト）はこんな感じです。

> **私**: 「背景画像フォルダからランダムに1枚選んで。その中央に、今日の名言を白文字で配置して。文字には読みやすいように黒い影をつけてね。フォントは `NotoSansJP-Bold` を使って。」

これだけで、AIは座標計算やフォントサイズ調整のコードを完璧に書いてくれます。
「文字がはみ出るんだけど？」と言えば、「じゃあ文字数に合わせて自動で改行する関数を追加しますね」と即修正。

今や私のフォルダには、AIが夜な夜な作り出した「名言画像」が何百枚もストックされています。

## 「APIキー漏洩」未遂事件

ここで一つ、背筋が凍るような失敗談を。
最初の頃、私はAPIキーをコードの中に直接書いていました。
`api_key = "abcdefg12345..."` みたいに。

これをGitHubにアップしようとした時、Antigravity（というかセキュリティアラート）が警告しました。
「そのコード、公開すると世界中の人があなたのアカウントを乗っ取れますよ」と。

**環境変数（.env）**という概念を知らなかったのです。
AIは優しく教えてくれました。

> **AI**: 「パスワード類はコードから切り離しましょう。`.env` というファイルを作ってそこに書き、コードからは `os.environ.get('API_KEY')` で読み込むのです。そして `.env` は絶対に公開してはいけません（`.gitignore` に入れましょう）。」

この「お作法」を知らないと、人生が終わるレベルの事故（クラウド破産など）につながります。
AIはコードを書くだけでなく、こうした**「守り」の知識**も教えてくれる先生なのです。
