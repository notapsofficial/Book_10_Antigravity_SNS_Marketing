# Part 3｜Xを実行環境としてつなぐ（最初の技術実装）

## 第1章：2026年のAPI環境と選択

### 1-1. X (Twitter) API を選ぶ理由

2026年現在、SNSのプラットフォームは多様化しています。
TikTok, Instagram, YouTube Shorts など、動画コンテンツが主流の時代において、なぜあえて X (旧Twitter) のAPIを選択するのか。
これには、技術的な学習コストと実装のしやすさという観点で、合理的な理由があります。

動画プラットフォームの自動化は、コンテンツ生成（レンダリング）やファイル転送のコストが高く、個人開発者が最初に挑戦するにはハードルが高い側面があります。
対して X は、テキストベースでの制御が中心であり、APIの構造もシンプルです。
Pythonなどのスクリプト言語から制御しやすく、システムとしてのSNS運用を学ぶための**「最初の実験場」**として非常に適しています。

### 1-2. コストについて（Basic Tierの現状）

実装に入る前に、費用の件について触れておく必要があります。
ご存知の方も多いと思いますが、現在の X API は無料枠（Free Tier）の制限が非常に厳しくなっています（書き込み上限や読み込み不可など）。

我々が目指す「運用システム（Antigravity）」を安定して稼働させるためには、現実的な選択肢として **Basic Tier（月額100ドル程度）** への加入が必要になるケースが多いのが現状です。

これは決して安い金額ではありません。
ただ、ビジネスユースや、自身のブランドを育てるための**「設備投資」**として捉えれば、十分にリターンのある投資だと私は考えています。
24時間稼働する広報システムをこのコストで維持できると考えれば、検討の余地はあるはずです。
※もちろん、まずはFree Tierの範囲で接続テストを行い、動作を確認してからアップグレードすることをお勧めします。

## 第2章：Developer Portal 設定ガイド

APIを利用するための設定は、いくつかのステップが必要です。
UIは頻繁に変更されるため、少し複雑に感じるかもしれませんが、概念を押さえれば大丈夫です。

### 2-1. Project と App の作成

開発者ポータル（Twitter Developer Portal）では、以下の階層構造で管理されます。

1.  **Project (プロジェクト)**: 全体の大枠です。
2.  **App (アプリ)**: 具体的なボットやツールを指します。APIキーはこのAppに紐づきます。

まずはProjectを作り、その中に一つAppを作成します。名前は「Test_Bot」などで構いません。

### 2-2. 権限設定（ここが重要です）

Appを作成した直後は、デフォルトで権限が **`Read Only`**（読み取り専用）になっていることが多いです。
このままでは投稿ができないため、設定を変更する必要があります。

1.  対象Appの `User authentication settings` を開きます。
2.  **App permissions** の項目で、**`Read and Write`** を選択します。
3.  **Type of App** は `Web App, Automated App or Bot` を選びます。
4.  **Callback URI / Redirect URL** などの必須項目を入力します（テスト段階では `https://example.com` などで通過できる場合が多いです）。

この設定変更を行うと、Client ID 等が表示されますが、今回主に使用するのは **OAuth 1.0a** のキーです。

### 2-3. キーの取得と保管

`Keys and Tokens` タブで、以下の4つの情報を取得（Regenerate）します。

1.  **API Key** (Consumer Key)
2.  **API Key Secret** (Consumer Secret)
3.  **Access Token**
4.  **Access Token Secret**

**注意**: これらのキーは、セキュリティの観点から**一度しか表示されません**。
必ず、パスワードマネージャーや安全なメモにコピーして保管してください。
もしわからなくなっても、再生成（Regenerate）すれば新しいキーが手に入るので、焦る必要はありません。

## 第3章：セキュリティ対策（安全な実装のために）

### 3-1. キーをコードに直接書かない

APIキーなどの機密情報を扱う際、最も避けたいのは**「コードの中に直接書いてしまうこと」**です。
誤ってGitHubなどの公開リポジトリにアップロードしてしまうと、キーが第三者に漏洩し、悪用されるリスクがあります。

これを防ぐための標準的な手法として、**環境変数**を使います。

#### Tips: AIに「事前に頼む」という防衛策
また、コード生成をAIに依頼する際、プロンプトで**「セキュリティ上の懸念がないように、フォルダやファイルを管理する構成にしてください」**と一言伝えておくのも非常に有効です。
そうすることで、AIはあなたの意図を汲み取り、最初からキーを別ファイル（.envなど）に分ける安全な実装パターンを提案してくれるようになります。
「うっかり事故」を防ぐためにも、AIをセキュリティの監視役として巻き込んでしまいましょう。

### 3-2. .env ファイルの活用

Pythonの場合、`python-dotenv` というライブラリを使うと便利です。
プロジェクトのルートディレクトリに `.env` という名前のファイルを作成し、そこにキーを記述します。

```text
# .env ファイル
X_API_KEY=あなたのAPIキー
X_API_SECRET=あなたのAPIシークレット
X_ACCESS_TOKEN=あなたのアクセストークン
X_ACCESS_TOKEN_SECRET=あなたのアクセストークンシークレット
```

### 3-3. .gitignore の設定

そして、この `.env` ファイル自体がGitに登録されないように、`.gitignore` ファイルに設定を追加します。

```text
# .gitignore ファイル
.env
__pycache__/
*.pyc
```

これで、ソースコードの変更履歴を管理しつつ、重要なキー情報はローカル環境だけに留めておくことができます。
これは、開発者として自分自身を守るための大切な習慣です。

## 第4章：接続テスト（Hello World）

### 4-1. 環境の準備

ここでは Python を使用した例を紹介します。
`tweepy` というライブラリが、ドキュメントも豊富で使いやすいため推奨しています。

```bash
# 作業用の仮想環境を作成（推奨）
python -m venv venv
source venv/bin/activate  # Windowsの場合は venv\Scripts\activate

# 必要なライブラリをインストール
pip install tweepy python-dotenv
```

### 4-2. テスト用スクリプト

以下に、接続確認用のシンプルなスクリプト（`post_test.py`）を記載します。

```python
import tweepy
import os
from dotenv import load_dotenv

# .env ファイルから環境変数を読み込む
load_dotenv()

# Client の初期化
client = tweepy.Client(
    consumer_key=os.getenv("X_API_KEY"),
    consumer_secret=os.getenv("X_API_SECRET"),
    access_token=os.getenv("X_ACCESS_TOKEN"),
    access_token_secret=os.getenv("X_ACCESS_TOKEN_SECRET")
)

def main():
    try:
        # 投稿内容は重複を防ぐため、テストごとに少し変えることをお勧めします
        text = "Hello, Antigravity System! #ConnectionTest"
        
        response = client.create_tweet(text=text)
        
        print("======== 成功 ========")
        print(f"以下のIDで投稿されました: {response.data['id']}")
        print("ブラウザで自身のアカウントを確認してください。")
        
    except Exception as e:
        print("======== エラー ========")
        print(f"投稿に失敗しました。設定を確認してください。")
        print(f"詳細: {e}")

if __name__ == "__main__":
    main()
```

### 4-3. 実行と確認

ターミナルで以下のコマンドを実行します。

```bash
python post_test.py
```

`======== 成功 ========"` と表示されれば、接続完了です。
もしエラーが出ても、心配はいりません。
多くの場合、キーのコピペミスや、`.env` ファイルの読み込みパスの違いなどが原因です。
エラーメッセージ（詳細部分）にはヒントが書かれていますので、それを頼りに一つずつ確認していきましょう。

成功したら、ぜひブラウザで自分のアカウントを見てみてください。
プログラムから投稿された「Hello」の文字が見えるはずです。
これは小さな一歩ですが、システムによるSNS運用の第一歩となる大きなマイルストーンです。

## 第5章：この章のまとめ

### チェックリスト
*   [x] X Developer Portal で App を作成し、権限設定とキー取得ができた。
*   [x] 環境変数（.env）を使って、キーを安全に管理する方法を理解した。
*   [x] Pythonスクリプト経由でテスト投稿を行い、動作を確認した。

接続という一番ハードルが高い部分はこれで完了です。
次章では、このシステムを運用していくための、具体的で無理のないワークフロー（部長モデル）についてお話しします。
いきなり全自動にするのではなく、人間が介在する安全な運用から始めていきましょう。
